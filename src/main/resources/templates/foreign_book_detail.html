<!--<link rel="stylesheet" type="text/css" th:href="@{/bootstrap.min.css}">-->
<html layout:decorate="~{layout}">
<div layout:fragment="content" class="container my-3">

    <div class="d-flex justify-content-center">
        <h2 class="text-light" th:text="${foreignBook.subject}"></h2>
    </div>

    <img th:src="|/ibookleague/foreignbook/images/${foreignBook.subject}|">
    <div class="my-3 d-flex justify-content-center text-light">
        <ul>
            <li th:text="'저자: ' + ${foreignBook.author}"></li>
            <li th:text="'책 소개: ' + ${foreignBook.content}"></li>
        </ul>
    </div>

    <div class="my-3"></div>
    <!-- 별접 입력 -->
    <div class="d-flex justify-content-center">
        <h5 class="text-light" th:text="|별점을 선택해주세요|"></h5>
    </div>
    <div class="d-flex justify-content-center" style="white-space: pre-line;">
        <form th:action="@{|/ibookleague/foreignbook/rate/create/${foreignBook.id}|}" method="post" id="rateForm">
            <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
                <input type="radio" class="btn-check" name="rate" id="rate1" value="1" autocomplete="off">
                <label class="btn btn-outline-primary" for="rate1">1</label>

                <input type="radio" class="btn-check" name="rate" id="rate2" value="2" autocomplete="off">
                <label class="btn btn-outline-primary" for="rate2">2</label>

                <input type="radio" class="btn-check" name="rate" id="rate3" value="3" autocomplete="off">
                <label class="btn btn-outline-primary" for="rate3">3</label>

                <input type="radio" class="btn-check" name="rate" id="rate4" value="4" autocomplete="off">
                <label class="btn btn-outline-primary" for="rate4">4</label>

                <input type="radio" class="btn-check" name="rate" id="rate5" value="5" autocomplete="off">
                <label class="btn btn-outline-primary" for="rate5">5</label>

            </div>
            <div class="d-flex justify-content-center">
                <input type="submit" value="별점등록" class="btn btn-primary my-2">
            </div>
        </form>
    </div>

    <!-- 별점 갯수 표시 -->
    <h5 class="border-bottom my-3 py-2 text-light" th:text="|${#lists.size(foreignBook.rateList)}개의 별점이 있습니다.|"></h5>
    <div class="my-3" th:each="foreignRate : ${foreignBook.rateList}">
        <ul>
            <li class="my-3 d-flex justify-content-between align-items-center">
                <h5 class="text-light" th:text="${foreignRate.rate}"></h5>

                <!-- 질문 수정 버튼 -->
                <!-- 본인이 작성한 별점만 수정가능, 커스텀 UserDetail 이용 -->
                <form th:action="@{|/ibookleague/foreignbook/rate/modify/${foreignRate.id}|}" method="post" class="d-flex align-items-center" sec:authorize="isAuthenticated()" th:if="${#authentication.getPrincipal().getUserId() == foreignRate.user}">
                    <label for="newrate" class="form-label">Rate range</label>
                    <input type="range" name="newrate" class="form-range" min="1" max="5" step="1" id="newrate">
                    <input type="submit" value="별점수정" class="btn btn-primary my-2">
                </form>
            </li>
        </ul>
    </div>

    <!-- 리뷰 갯수 표시 -->
    <h5 class="border-bottom my-3 py-2 text-light" th:text="|${#lists.size(foreignBook.reviewList)}개의 리뷰가 있습니다.|"></h5>
    <div class="card my-3 bg-secondary" th:each="foreignReview : ${foreignBook.reviewList}">
        <div class="card-body">
            <div class="card-text text-dark" style="white-space: pre-line;" th:text="${foreignReview.content}"></div>
        </div>
    </div>

    <!-- 리뷰 입력 -->
    <form th:action="@{|/ibookleague/foreignreview/create/${foreignBook.id}|}" method="post">
        <textarea name="content" id="content" rows="15" class="form-control bg-secondary"></textarea>
        <div class="d-flex justify-content-center">
            <input type="submit" value="리뷰등록" class="btn btn-primary my-2">
        </div>
    </form>
</div>

<script layout:fragment="script" type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        <!-- 경고 메시지 표시 부분 -->
        <!-- 경고 메시지를 서버에서 받아옴 -->
        var warningMessage = "${warningMessage}";
        var form = document.getElementById('rateForm')

        if (warningMessage) {
            <!-- 경고 메시지 표시 -->
            form.addEventListener('submit', function () { alert("한 사용자는 한번의 평점만 남길 수 있습니다."); });
        }
    });
</script>
</html>